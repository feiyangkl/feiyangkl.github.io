---
title: "GCD"

date: "2016-09-21 10:29:32"

tags: 
    - iOS
---



## GCD 核心概念

1. 将`任务`添加到`队列`，并且指定`执行任务的函数`
2. 任务使用 `block` 封装
    * 任务的 `block` 没有参数也没有返回值
3. 执行任务的函数
    * 异步 `dispatch_async`
        * 不用等待当前语句执行完毕，就可以执行下一条语句
        * 会开启线程执行 `block` 的任务
        * `异步`是多线程的代名词
    * 同步 `dispatch_sync`
        * 必须等待当前语句执行完毕，才会执行下一条语句
        * 不会开启线程
        * 在当前执行 `block` 的任务
4. 队列 - 负责调度任务
    * 串行队列
        * 一次只能"调度"一个任务
        * `dispatch_queue_create("feiyangkl", NULL);`
    * 并发队列
        * 一次可以"调度"多个任务
        * `dispatch_queue_create("feiyangkl", DISPATCH_QUEUE_CONCURRENT);`
    * 主队列
        * 专门用来在主线程上调度任务的队列
        * 不会开启线程
        * **在`主线程空闲时`才会调度队列中的任务在主线程执行**
        * `dispatch_get_main_queue();`

 <!-- more -->

## 阶段性小结

* 开不开线程由`执行任务的函数`决定
    * `异步`开，`异步`是多线程的代名词
    * `同步`不开
* 开几条线程由`队列`决定
    * `串行队列`开一条线程
    * `并发队列`开多条线程，具体能开的线程数量由底层线程池决定
        * iOS 8.0 之后，GCD 能够开启非常多的线程
        * iOS 7.0 以及之前，GCD 通常只会开启 5~6 条线程

## - 队列的选择

* 多线程的目的：将耗时的操作放在后台执行！

* 串行队列，只开一条线程，所有任务顺序执行
    * 如果任务有先后执行顺序的要求
    * 效率低 -> 执行慢 -> "省电"
    * 有的时候，用户其实不希望太快！例如使用 3G 流量，"省钱"
* 并发队列，会开启多条线程，所有任务不按照顺序执行
    * 如果任务没有先后执行顺序的要求
    * 效率高 -> 执行快 -> "费电"
    * WIFI，包月

### 实际开发中，线程数量如何决定?

* WIFI 线程数 `6` 条
* 3G / 4G 移动开发的时候，`2~3`条，再多会费电费钱！
